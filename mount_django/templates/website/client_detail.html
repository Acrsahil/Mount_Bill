{% extends 'layout.html' %}
{% load static %}

{% block extra_css %}
<script src="https://cdn.tailwindcss.com"></script>
{% endblock %}

{% block content %}

<!-- HEADER -->
<header class="flex justify-between items-center px-6 py-3 border-b bg-white">
    <!-- Left: Date -->
    <span class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-full">
        Today: {% now "F j, Y" %}
    </span>

    <!-- Right: Time + User -->
    <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2 text-sm text-gray-600">
            <i class="fas fa-clock"></i>
            <span>{% now "h:i A" %}</span>
        </div>
       <div
          class="w-8 h-8 !bg-gradient-to-r !from-[#4361ee] !to-[#3a0ca3] !text-white rounded-full flex items-center justify-center font-bold text-sm">
          {{ request.user.username.0|upper }}
      </div>

    </div>
</header>

<!-- PAGE -->
<div class="flex h-[calc(100vh-64px)]">

    <!-- SIDEBAR -->
    <aside class="w-96 border-r p-4 flex flex-col space-y-4">

        <!-- Clients header -->
        <div class="flex justify-between items-center">
            <h2 class="font-semibold text-lg">
                Clients ({{ client_num }})
            </h2>
            <button class="btn flex items-center gap-1 px-3 py-1 text-white rounded
            !bg-gradient-to-r !from-[#4361ee] !to-[#3a0ca3]
            hover:!from-[#3f5bdc] hover:!to-[#320b8f]" id="addNewClientDetailBtn">
              <i class="fas fa-plus-circle"></i> Add Client
            </button>

        </div>

        <!-- Search + Sort -->
        <div class="flex items-center gap-2">
            <div class="flex items-center gap-2 border rounded px-2 py-1 flex-1">
                <i class="fas fa-search text-gray-400"></i>
                <input
                    type="text"
                    id="clientDetailSearch"
                    placeholder="Search clients..."
                    class="w-full outline-none text-sm"
                >
            </div>

            <button class="btn btn-secondary whitespace-nowrap" id="sortClientBtn">
                <i class="fa-solid fa-sort"></i> Sort By
            </button>
        </div>

        <!-- Filters -->
        <div class="flex gap-2">
            <button class="btn btn-secondary flex-1 border border-gray-300 px-3 py-1 rounded" id="customers">Customer</button>
            <button class="btn btn-secondary flex- border border-gray-300 px-3 py-1 rounded" id="suppliers">Supplier</button>
            <button class="btn btn-secondary flex-1 border border-gray-300 px-3 py-1 rounded" id="allpayment">All Payment</button>
        </div>

        <!-- Client list -->
        <div class="flex-1 overflow-y-auto">
            <ul class="clientList space-y-2">
                <!-- dynamic clients here -->
            </ul>
        </div>

    </aside>
<main class="client-main flex-1 w-full bg-gray-50">

  <div class="p-6 space-y-3">

    <!-- ROW 1 -->
    <div class="flex items-start w-full">
      <div class="text-xl text-900 font-semibold" id = "clientName">
        {{ customer_info.name }}
      </div>

      <div class="ml-auto text-right">
        <div class="text-xl text-500 font-semibold">Receivable</div>
       
      </div>
    </div>

    <!-- ROW 2 -->
    <div class="flex w-full text-gray-500">
      <div id="clientDetail">{%if customer_info.address%}
              {{ customer_info.address }}
              {%elif customer_info.phone%}
              {{customer_info.phone}}
            {%else%}
              ---
            {%endif%}</div>
        <div class="text-xl font-semibold text-emerald-600 ml-auto text-right">-----
          {{ client_transaction }}
        </div>
    </div>

    <!-- ROW 3 -->
    <div class="flex w-full items-center">
      <div class="flex space-x-2">
        <button class="btn flex items-center gap-1 border border-gray-300 px-3 py-1 rounded" id="clientEditBtn">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="btn flex items-center gap-1 border border-gray-300 px-3 py-1 rounded">
          <i class="fas fa-trash"></i> Delete
        </button>
        <button class="btn border border-gray-300 px-3 py-1 rounded"><i class="fas fa-file-pdf"></i> PDF</button>
      </div>

      <div class="ml-auto">
        <button class="btn !bg-gradient-to-r !from-[#4361ee] !to-[#3a0ca3] !text-white px-3 py-1 rounded hover:!from-[#3f5bdc] hover:!to-[#320b8f']">
  <i class="fas fa-bell"></i> Send Reminder
</button>

      </div>
    </div>
<!-- Divider line -->
<hr class="border-t border-gray-300 my-4">

<!-- Transaction Header Row -->
<div class="flex items-center w-full">

  <!-- Left: title -->
  <h2 class="text-lg font-semibold">
    Transaction (1)
  </h2>

  <!-- Right: actions -->
  <div class="ml-auto flex items-center gap-3">

    <div class="flex items-center gap-2 border rounded px-2 py-1">
      <i class="fas fa-search text-gray-400"></i>
      <input 
        type="text" 
        id="transactionSearchInput" 
        placeholder="Search transaction..."
        class="outline-none text-sm"
      >
    </div>

    <button class="btn border border-gray-300 px-3 py-1 rounded" id="transactionSortBtn">
      <i class="fa-solid fa-sort"></i> Sort By
    </button>

   <button
  class="btn px-3 py-1 text-white rounded
         !bg-gradient-to-r !from-[#4361ee] !to-[#3a0ca3]
         hover:!from-[#3f5bdc] hover:!to-[#320b8f]" id="addTransaction">
  <i class="fas fa-plus-circle"></i>
  Add Transaction
</button>

  </div>

</div>
<div class="transactionDetail w-full mt-3">
  <table class="w-full border text-sm" id="transactionTable">
    <thead class="bg-gray-100">
      <tr>
        <th class="p-2 text-left">Type</th>
        <th class="p-2 text-left">Date</th>
        <th class="p-2 text-left">Total</th>
        <th class="p-2 text-left">Status</th>
        <th class="p-2 text-left">Balance</th>
        <th class="p-2 text-left">Remarks</th>
      </tr>
    </thead>

    <tbody id="clientTransactionTableBody">
    </tbody>
  </table>
</div>
<div
  id="paymentTransactions"
  class="absolute hidden mt-0.5 z-50 w-44
         bg-white border border-gray-200
         rounded-lg shadow-lg
         py-1 "
>
  <ul class="text-sm text-gray-700">
    <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" id= "salesInvoice">
      Sales Invoice
    </li>
    <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" id= "paymentIn">
      Payment In
    </li>
    <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer" id= "paymentOut">
      Payment Out
    </li>
  </ul>
</div>

{% comment %} payment in modal {% endcomment %}
<!-- Payment In Modal -->
<div id="paymentModal"
     class="fixed inset-0 bg-black/40 flex items-center justify-center z-50 hidden">

  <!-- Modal -->
  <div
  class="bg-white w-full max-w-3xl rounded-lg shadow-lg p-6"
  onclick="event.stopPropagation()"
>

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">

      <h2 class="text-xl font-semibold text-gray-800" id="paymentHeader">
        Add Payment In
      </h2>

      <!-- Close Button -->
      <button
        type="button"
        class="w-8 h-8 flex items-center justify-center rounded-full
               text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition"
        aria-label="Close"
      >
        âœ•
      </button>

    </div>

    <!-- Body -->
    <div class="space-y-5">

      <!-- First Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-600 mb-1">Receipt Number</label>
          <input
            type="text"
            placeholder="ID from DB"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" id="receiptNumber">
        </div>

        <div>
          <label class="block text-sm text-gray-600 mb-1">Date</label>
          <input
            type="date"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" id="paymentInDate">
        </div>
      </div>

      <!-- Second Row -->
      <div>
        <label class="block text-sm text-gray-600 mb-1">Party Name</label>
        <input
          type="text"
          class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" id="partyName">
      </div>

      <!-- Third Row -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-600 mb-1" id="amountInputLabel">Received Amount</label>
          <input
            type="text"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" id= "amountInput">
        </div>

        <div>
          <label class="block text-sm text-gray-600 mb-1">Payment Method</label>
          <input
            type="text"
            placeholder="Cash"
            class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
        </div>
      </div>

      <!-- Fourth Row -->
      <div>
        <label class="block text-sm text-gray-600 mb-1">Remarks</label>
        <input
          type="text"
          class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none" id="paymentInRemarks">
      </div>

    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-3 mt-8 pt-4 border-t">

      <button
        class="px-4 py-2 border border-gray-300 rounded-md text-sm
               text-gray-700 hover:bg-gray-100 transition">
        Save & New
      </button>

      <button
        class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm
               hover:bg-blue-700 transition" id="savePaymentIn">
        Save Payment In
      </button>
      <button
        class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm
               hover:bg-blue-700 transition" id="savePaymentOut">
        Save Payment Out
      </button>

    </div>

  </div>
</div>


  </div>



</main>
 

</div>

{% include "website/modal/client_add_modal.html" %}
{% comment %} {% include "website/create_invoice.html" %} {% endcomment %}
{% endblock %}
{% block extra_js %}
<script>
// Simple and safe data structure
window.djangoData = {
    products: {{ product|safe }},
    product_cat: {{ product_cat|safe }},
    clients: {{ customer|safe }},
    invoices: {{ invoices|safe }},
    csrfToken: "{{ csrf_token }}",
    active_tab: "{{ active_tab|default:'dashboard' }}"
};

// SAFETY CHECK
if (typeof window.djangoData === 'undefined') {
    window.djangoData = {
        products: [],
        product_cat: [],
        clients: [],
        invoices: {{ invoices|safe }},
        csrfToken: "{{ csrf_token }}",
        active_tab: "{{ active_tab|default:'dashboard' }}"
    };
}

console.log('Active tab:', window.djangoData.active_tab);
</script>

<script>const csrfToken = "{{ csrf_token }}";</script>
<script type="module" src="{%static 'js/client_detail.js'%}"></script>
<script type="module" src="{%static 'js/client.js'%}"></script>
<script type="module" src="{% static 'js/main.js' %}"></script>
<script type="module" src="{% static 'js/event.js' %}"></script>
{% endblock %}

